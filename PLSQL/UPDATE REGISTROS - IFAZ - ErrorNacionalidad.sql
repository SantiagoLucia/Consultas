------  "ERROR DE NACIONALIDAD" REGISTROS PARA SER TOMADOS EN EL REPROCESO
SET SERVEROUTPUT ON
SET DEFINE OFF

DECLARE
V_REGISTROS_MODIFICADOS NUMBER (30);
V_NUMERO_ESPERADO NUMBER (30);
REG_ACT_EXCEPTION EXCEPTION;
V_ID_IFAZ_DEFUNCION_RENAPER NUMBER (30);

TYPE VARRAY_IFAZ IS VARRAY(500) OF INT;
V_ARRAY_IFAZ VARRAY_IFAZ := VARRAY_IFAZ(

623255,623256,623257,623259,623260,623261,623262,623263,623264,623265,623266,623267,623268,623269,623270,623271,623272,
623273,623274,623275,623276,623277,623278,623279,623280,623281,623282,623283,623284,623285,623286,623287,623288,623289,
623290,623291,623292,623293,623294,623295,623296,623297,623298,623300,623301,623302,623304,623305,623306,623307,623308,
623309,623310,623312,623313,623314,623315,623317,623318,623319,623320,623321,623322,623323,623324,623325,623326,623328,
623329,623330,623331,623332,623333,623334,623335,623336,623337,623338,623339,623340,623341,623343,623344,623345,623346,
623347,623348,623349,623350,623351,623352,623354,623355,623356,623357,623358,623359,623360,623362,623363,623364,623365,
623366,623367,623368,623369,623370,623371,623372,623373,623374,623375,623376,623377,623378,623379,623380,623382,623381,
623383,623384,623385,623386,623387,623388,623390,623389,623391,623392,623393,623394,623395,623396,623397,623398,623399,
623400,623401,623402,623403,623404,623405,623406,623407,623408,623409,623410,623411,623412,623413,623414,623415,623416,
623417,623418,624170,624171,624172,624174,624175,624176,624177,624178,624179,624180,624181,624182,624183,624184,624185,
624186,624187,624188,624189,624190,624191,624192,624193,624194,624196,624197,624198,624199,624200,624201,624202,624203,
624204,624205,624206,624208,624209,624210,624211,624212,624213,624214,624215,624216,624217,624218,624219,624220,624221,
624222,624223,624224,624225,624226,624227,624228,624229,624230,624231,624232,624233,624234,624235,624236,624237,624238,
624239,624241,624242,624243,624244,624245,624246,624247,624248,624249,624250,624251,624252,624253,624254,624255,624256,
624257,624258,624259,624260,624261,624262,624265,624266,624267,624268,624269,624271,624273,624274,624275,624276,624277,
624280,624282,624283,624285,624286,624287,624288,624289,624290,624291,624292,624293,624294,624295,624296,624297,624298,
624299,624300,624302,624303,624304,624305,624306,624307,624309,624308,624310,624311,624315,624316,624317,624318,624320,
624323,624324,624325,624326,624328,624327,624329,624331,624332,624333,624334,624335,624336,624337,624338,624340,624341,
624342,624343,624344,624345,624347,624348,624349,624350,624351,624352,624353,624354,624355,624356,624357,624358,624359,
624360,624362,624364,624363,624365,624366,624367,624368,624369,624370,624371,624372,624373,624374,624375,624377,624378,
624379,624380,624381,624382,624383,624384,624385,624386,624387,624388,624389,624390,624391,624392,624393,624394,624395,
624396,624397,624398,624399,624400,624401,624402,624403,624404,624405,624406,624407,624408,624409,624410,624411,624412,
624413,624414,624415,624416,624417,624418,624419,624420,624421,624422,624423,624424,624425,624426,624427,624428,624429,
624430,624431,624432,624433,624434,624435,624436,624437,624438,624439,624440,624441,624442,624443,624444,624445,624446,
624447,624448,624449,624450,624452,624453,624454,624455,624456,624459,624460,624461,624462,624463,624464,624465,624466,
624467,624468,624469,624470,624471,624472,624473,624474,624475,624476,624477,624478,624479,624480,624481,624482,624483,
624484,624485,624486,624487,624488,624489,624490,624491,624493,624494,624495,624496,624497,624498,624499,624501,624502,
624503,624504,624505,624506,624507,624508,624509,624510,624511,624512,624513,624515,624516,624517,624518,624519,624520,624521

);

BEGIN

	V_NUMERO_ESPERADO := V_ARRAY_IFAZ.COUNT;
	V_REGISTROS_MODIFICADOS := 0;

	DBMS_OUTPUT.PUT_LINE ('***COMIENZA SCRIPT***');
	DBMS_OUTPUT.PUT_LINE ('SE ESPERAN MODIFICAR '||V_NUMERO_ESPERADO ||' REGISTROS');

-- BLOQUE UPDATE

FOR I IN 1..V_ARRAY_IFAZ.COUNT LOOP
	UPDATE RCE_GED.RCE_IFAZ_DEFUNCION_RENAPER
	SET INFORME_FALLECIMIENTO_CODIGO = NULL,
	INFORME_FALLECIMIENTO_MENSAJE = NULL

WHERE ID_IFAZ_DEFUNCION_RENAPER = V_ARRAY_IFAZ(I);
V_REGISTROS_MODIFICADOS := V_REGISTROS_MODIFICADOS + SQL%ROWCOUNT;
END LOOP;

-- BLOQUE UPDATE END

COMMIT;
DBMS_OUTPUT.PUT_LINE ('SE MODIFICARON '||V_REGISTROS_MODIFICADOS||' REGISTROS');
DBMS_OUTPUT.PUT_LINE ('***COMMIT REALIZADO***');

EXCEPTION
	WHEN REG_ACT_EXCEPTION THEN
	BEGIN
		ROLLBACK;
		DBMS_OUTPUT.PUT_LINE ('SE REALIZA ROLLBACK DE TRANSACCIÓN: ');
		DBMS_OUTPUT.PUT_LINE ('LA CANTIDAD DE REGISTROS MODIFICADOS NO COINCIDE CON LA ESPERADA ' || V_REGISTROS_MODIFICADOS);
	END;

	WHEN OTHERS THEN
	BEGIN
		ROLLBACK;
		DBMS_OUTPUT.PUT_LINE ('SE REALIZA ROLLBACK DE TRANSACCIÓN: ');
		DBMS_OUTPUT.PUT_LINE (' ' || SUBSTR (SQLERRM,1, 200));
	END;

END;